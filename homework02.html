<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <title>Document</title>
    <style>
        .box {
            width: 800px;
            display: flex;
            justify-content: center;
            margin: auto;
            background: #ff6c6c;
        }

        .back {
            width: 80%;
            background-color: #000000;

            & .v1 {
                width: 100%;
            }

            & .back2 {
                height: 50px;
                background-color: #000000;
                display: grid;
                grid-template-columns: 1fr 1fr 3fr 1fr 1fr;
                grid-template-rows: 1fr;
                border: 1px solid rgb(255, 0, 0);

                & button {
                    height: 100%;

                }
            }

            & .back2-1 {
                display: grid;
                grid-template-rows: 1fr 1fr;
                border: 1px solid rgb(255, 236, 109);
            }
        }

        svg {
            width: 25%;

        }

        .flipped {
            transform: rotate(180deg);
            background-color: rgba(0, 0, 0, 0);
        }

        .playVideo {
            width: 20%;

            & input {
                display: none;
            }

            & button {
                width: 50px;
                background-color: rgba(0, 0, 0, 0);
                border: none;
            }

            & a {
                height: 20px;
                display: flex;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                justify-content: center;
                list-style-type: none;
                background-color: steelblue;
                margin: 10px;
                padding: 5px;
            }

            & svg {
                width: 100%;
                height: 100%;

            }
        }

        .dragging {
            opacity: 0.5;
        }
    </style>

</head>

<body>
    <div class="box">
        <div class="back">
            <video src="/video/video1.mp4" class="v1" poster="/pic/landscape-photography_1645.jpg"></video>
            <div class="back2">
                <button class="button" id="button1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                        <path
                            d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4l-192 160L64 241V96c0-17.7-14.3-32-32-32S0 78.3 0 96V416c0 17.7 14.3 32 32 32s32-14.3 32-32V271l11.5 9.6 192 160z" />
                    </svg></button>
                <button class="button" id="button2"><svg class="flipped" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 320 512">
                        <path
                            d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4l-192 160L64 241V96c0-17.7-14.3-32-32-32S0 78.3 0 96V416c0 17.7 14.3 32 32 32s32-14.3 32-32V271l11.5 9.6 192 160z" />
                    </svg></button>
                <div class="back2-1">
                    <input type="range" id="range" value="0" min="0" max="100" step="0.1">
                    <input type="range" id="range2" value="0" min="0" max="1" step="0.1">
                </div>
                <button class="button" id="button3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                        <path
                            d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z" />
                    </svg></button>
                <button class="button" id="button4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                        <path
                            d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z" />
                    </svg></button>
            </div>
        </div>
        <div class="playVideo" id="playVideo">
            <input type="file" id="fileplus" multiple>
            <button id="btnplus"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                    <path
                        d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM200 344V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H248v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z" />
                </svg></button>
            <div id="playList">
                <a data-src="/video/video1.mp4" draggable="true">Video 1<button id="btnDelect"><svg
                            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                            <path
                                d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z" />
                        </svg></button></a>
                <a data-src="/video/video2.mp4" draggable="true">Video 2<button><svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 448 512">
                            <path
                                d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z" />
                        </svg></button></a>
                <a data-src="/video/video3.mp4" draggable="true">Video 3<button><svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 448 512">
                            <path
                                d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z" />
                        </svg></button></a>
                <a data-src="/video/video4.mp4" draggable="true">Video 4<button><svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 448 512">
                            <path
                                d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z" />
                        </svg></button></a>
            </div>


        </div>
    </div>

    <script>
        let video = document.querySelector('.v1');
        let btnup = document.querySelector('#button1');
        let btndown = document.querySelector('#button2');
        let btnstop = document.querySelector('#button3');
        let btnstart = document.querySelector('#button4');
        let progress = document.querySelector('#range');
        let voice = document.querySelector('#range2');
        let playListItems = document.querySelectorAll('#playList a');
        let btnplus = document.querySelector('#btnplus');
        let btnDelect = document.querySelector('#btnDelect');
        let fileInput = document.getElementById('fileplus');
        playNum = 0;
        console.log(playNum);
        const playVideo = [];

        document.addEventListener('DOMContentLoaded', function () {

            // 更新滑動條的最大值為影片的總時長
            video.addEventListener('loadedmetadata', function () {
                progress.max = video.duration;
            });

            // 當滑動條的值改變時，設置影片的當前播放時間
            progress.addEventListener('input', function () {
                video.currentTime = progress.value;
            });

            // 當影片的播放時間更新時，更新滑動條的值
            video.addEventListener('timeupdate', function () {
                progress.value = video.currentTime;
            });

            // 當音量滑動條的值改變時，設置影片的音量
            voice.addEventListener('input', function () {
                video.volume = voice.value;
            });



            // 移除之前的事件監聽器
            fileInput.removeEventListener('change', handleFileChange);

            //新增上傳的檔案
            function handleFileChange() {
                const files = fileInput.files;
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const videoURL = URL.createObjectURL(file); // 創建文件的URL

                    // 创建新的播放列表项
                    const newListItem = document.createElement('a');
                    newListItem.setAttribute('data-src', videoURL); // 設置新項目的數據源屬性
                    newListItem.draggable = true; // 設置為可拖曳
                    newListItem.innerText = `Video ${playVideo.length + 1}`; // 設置新項目的文本內容
                    const newButton = document.createElement('button'); // 創建刪除按鈕
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg"); // 創建 SVG 元素
                    svg.setAttribute("viewBox", "0 0 448 512");
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path"); // 創建 SVG path 元素
                    path.setAttribute("d", "M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm88 200H296c13.3 0 24 10.7 24 24s-10.7 24-24 24H152c-13.3 0-24-10.7-24-24s10.7-24 24-24z");
                    svg.appendChild(path);
                    newButton.appendChild(svg);
                    newListItem.appendChild(newButton); // 添加刪除按鈕到新項目
                    document.getElementById('playList').appendChild(newListItem); // 將新項目添加到播放清單

                    playVideo.push(videoURL); // 添加新的影片URL到播放清單數組

                    // 为新项目添加点击事件监听器
                    newListItem.addEventListener('click', function (event) {
                        event.preventDefault();
                        playNum = playVideo.indexOf(videoURL); // 獲取影片索引
                        video.src = videoURL; // 設置播放器的影片源
                        video.play(); // 播放影片
                        console.log('播放的影片索引:', playNum);
                    });

                    // 为新项目添加删除功能
                    addDeleteFunctionality(newListItem, videoURL);

                    // 为新项目添加拖曳事件监听器
                    newListItem.addEventListener('dragstart', function (event) {
                        draggedItem = newListItem;
                        newListItem.classList.add('dragging');
                    });
                    newListItem.addEventListener('dragend', function (event) {
                        newListItem.classList.remove('dragging');
                    });
                    newListItem.addEventListener('dragover', function (event) {
                        event.preventDefault();
                    });
                    newListItem.addEventListener('drop', function (event) {
                        event.preventDefault();
                        // 如果置放的對象不是和拖曳對象一樣
                        if (this !== draggedItem) {
                            let list = this.parentNode;
                            // 找到拖曳對象的父層節點
                            let draggingIndex = [...list.children].indexOf(draggedItem);
                            // 計算拖曳對象在父層的子元素中的索引值
                            let dropIndex = [...list.children].indexOf(this);
                            // 計算置放區在父層的子元素中的索引值

                            if (draggingIndex > dropIndex) {
                                // 計算是要往前放還是往後放，拖曳索引值大於置放索引值，往前放
                                list.insertBefore(draggedItem, this);
                            } else {
                                // 計算是要往前放還是往後放，拖曳索引值小於等置放索引值，往後放
                                list.insertBefore(draggedItem, this.nextSibling);
                            }
                        }
                    });
                }
            }

            // 为上传按钮添加点击事件监听器
            btnplus.addEventListener('click', () => {
                fileInput.click(); // 模擬點擊文件輸入元素

                // 移除之前的事件監聽器，然後添加新的
                fileInput.removeEventListener('change', handleFileChange);
                fileInput.addEventListener('change', handleFileChange);
            });

            // 播放清單項目點擊事件處理
            playListItems.forEach(function (item, index) {
                item.addEventListener('click', function (event) {
                    event.preventDefault();
                    const videoSrc = item.getAttribute('data-src');
                    playNum = index; // 將 playNum 設置為清單項目的索引
                    video.src = videoSrc; // 設置播放器的影片源
                    video.play(); // 播放影片
                    console.log('播放的影片索引:', playNum);
                });
            });

            //播放清單項目拖移排序
            playListItems.forEach(function (item, index) {
                item.addEventListener('dragstart', function (event) {
                    draggedItem = item;
                    item.classList.add('dragging');
                });
                item.addEventListener('dragend', function (event) {
                    item.classList.remove('dragging');


                });
                item.addEventListener('dragover', function (event) {
                    event.preventDefault();
                });
                item.addEventListener('drop', function (event) {
                    event.preventDefault();
                    // 如果置放的對象不是和拖曳對象一樣
                    if (this !== draggedItem) {
                        let list = draggedItem.parentNode;
                        // 找到拖曳對象的父層節點
                        let draggingIndex = [...list.children].indexOf(draggedItem);
                        // 計算拖曳對象在父層的子元素中的索引值
                        let dropIndex = [...list.children].indexOf(this);
                        // 計算置放區在父層的子元素中的索引值

                        if (draggingIndex > dropIndex) {
                            // 計算是要往前放還是往後放，拖曳索引值大於置放索引值，往前放
                            list.insertBefore(draggedItem, this);
                        } else {
                            // 計算是要往前放還是往後放，拖曳索引值小於等置放索引值，往後放
                            list.insertBefore(draggedItem, this.nextSibling);
                        }
                    }
                });
            })


            /// 添加删除功能
            function addDeleteFunctionality(item, videoURL) {
                const deleteButton = item.querySelector('button');
                deleteButton.addEventListener('click', function (event) {
                    event.stopPropagation(); // 阻止事件冒泡，避免触发播放事件

                    // 从播放列表数组中移除视频URL
                    const index = playVideo.indexOf(videoURL);
                    if (index > -1) {
                        playVideo.splice(index, 1);
                    }

                    // 从DOM中移除播放列表项
                    item.remove();

                    // 调整playNum
                    if (playNum >= playVideo.length) {
                        playNum = playVideo.length - 1;
                    }

                    console.log('播放的影片索引:', playNum);
                });
            }

            // 为现有播放列表项添加删除功能
            playListItems.forEach(function (item) {
                const videoSrc = item.getAttribute('data-src');
                addDeleteFunctionality(item, videoSrc);
            });
        });





        // 填充播放清單
        playListItems.forEach(function (item) {
            const videoSrc = item.getAttribute('data-src');
            playVideo.push(videoSrc);
        });

        // 下一部影片
        btndown.addEventListener("click", (event) => {
            playNum++;

            if (playNum == playVideo.length) {
                playNum = 0;
            }
            console.log(playNum);
            video.src = playVideo[playNum];
            video.play();
        })

        // 上一部影片
        btnup.addEventListener("click", (event) => {
            playNum--;

            if (playNum == -1) {
                playNum = 3;
            }
            console.log(playNum);
            video.src = playVideo[playNum];
            video.play();
        })
        // 開始播放或繼續播放影片
        btnstart.addEventListener("click", () => {

            if (video.currentTime == 0) {
                video.src = playVideo[playNum];
                video.play();
            } else {
                (video.paused) ? video.play() : console.log("按暫停鍵");
            }

        });

        // 暫停影片
        btnstop.addEventListener("click", () => {
            (video.paused) ? console.log("按開始鍵") : video.pause();
        });

        // 當影片播放結束時，自動播放下一部影片
        video.addEventListener("ended", () => {
            playNum++;
            if (playNum >= playVideo.length) {
                playNum = 0;
            }
            video.src = playVideo[playNum];
            video.play();
        });

    </script>
</body>

</html>